# Cookie Exporter 浏览器插件开发文档

## 目录
1. [概述](#概述)
2. [技术架构](#技术架构)
3. [文件结构](#文件结构)
4. [核心功能实现](#核心功能实现)
5. [权限说明](#权限说明)
6. [安装和使用](#安装和使用)
7. [故障排除](#故障排除)
8. [安全注意事项](#安全注意事项)

## 概述

Cookie Exporter 是一个基于 Chrome Manifest V3 的浏览器扩展插件，旨在帮助用户方便地导出浏览器中的 Cookie 信息并保存为多种格式的文件。该插件提供了三种主要功能模式：

1. 导出功能 - 导出浏览器 Cookie 为多种格式（JSON、CSV、XML、Netscape）
2. 导入功能 - 从文件导入 Cookie 到浏览器
3. 管理功能 - 查看、搜索、过滤和删除 Cookie

该插件严格遵循 Chrome 扩展的最佳实践，具有良好的安全性和用户隐私保护机制。

### 主要功能特性

- 一键导出当前网站 Cookie 或所有 Cookie
- 支持多种导出格式：JSON、CSV、XML、Netscape Cookie 格式
- Cookie 导入功能，支持多种格式文件
- 复制 Cookie 到剪贴板功能
- Cookie 管理界面，支持搜索、过滤和删除
- 进度条显示，提升用户体验
- 多语言支持（中文、英文、法文）
- 模块化代码结构，易于维护和扩展
- 快捷键支持，提高操作效率
- 拖放文件导入支持

### 使用场景

- 开发人员调试网站 Cookie 设置
- 迁移 Cookie 数据到其他浏览器或设备
- 分析网站跟踪和用户行为
- 教育和研究目的的 Cookie 数据分析
- 备份重要的 Cookie 信息
- Cookie 数据格式转换

## 技术架构

Cookie Exporter 插件采用 Chrome Manifest V3 架构规范，主要由以下组件构成：

### 核心组件

1. **Manifest 文件** - [manifest.json](file:///c:/Users/82490/Desktop/LingmaPythonProject/manifest.json)：插件的配置文件，定义了插件的基本信息、权限和资源
2. **Service Worker** - [background.js](file:///c:/Users/82490/Desktop/LingmaPythonProject/background.js)：后台脚本，负责处理 Cookie API 调用
3. **Popup 界面** - [popup.html](file:///c:/Users/82490/Desktop/LingmaPythonProject/popup.html) 和 [popup.js](file:///c:/Users/82490/Desktop/LingmaPythonProject/popup.js)：用户交互界面和前端逻辑
4. **格式化模块** - [cookieFormatter.js](file:///c:/Users/82490/Desktop/LingmaPythonProject/cookieFormatter.js)：处理 Cookie 数据格式转换的独立模块

### 技术栈

- **核心**：JavaScript (ES6+)
- **API**：Chrome Extensions API
- **UI**：HTML5, CSS3
- **规范**：Manifest V3

### 架构特点

1. **安全性**：遵循最小权限原则，仅申请必要的权限
2. **模块化**：各组件职责清晰，便于维护和扩展
3. **异步处理**：合理使用 Promise 和回调函数处理异步操作
4. **错误处理**：完善的错误捕获和用户提示机制
5. **国际化**：支持多语言界面
6. **用户体验**：提供进度条、快捷键、拖放等增强功能

## 文件结构

```
project/
├── _locales/              # 国际化资源文件
│   ├── en/                # 英文语言包
│   ├── fr/                # 法文语言包
│   └── zh_CN/             # 中文语言包
├── manifest.json          # 插件配置文件
├── background.js          # 后台服务工作者
├── cookieFormatter.js     # Cookie 格式化模块
├── content.js             # 内容脚本
├── popup.html             # 弹出界面
├── popup.js               # 界面交互逻辑
├── README.md              # 用户使用说明
└── DEVELOPMENT.md         # 开发文档
```

### 文件详细说明

1. **manifest.json**
   - 定义插件名称、版本、描述等基本信息
   - 声明所需权限（cookies、activeTab等）
   - 配置 popup 页面和 background service worker
   - 定义内容脚本和可访问资源

2. **background.js**
   - 监听来自 popup 的消息
   - 调用 Chrome cookies API 获取 Cookie 数据
   - 按域名分组处理所有 Cookie 数据
   - 处理 Cookie 导入请求

3. **cookieFormatter.js**
   - 独立的 Cookie 格式化模块
   - 提供多种格式的导出和导入功能
   - 包含 JSON、CSV、XML、Netscape 格式处理
   - 可在多个组件中复用

4. **content.js**
   - 内容脚本，用于加载 cookieFormatter 模块
   - 确保模块在需要时正确加载

5. **popup.html**
   - 提供用户界面，包含三个标签页（导出、导入、管理）
   - 包含导出按钮、导入区域、Cookie 管理界面
   - 引入 popup.js 脚本

6. **popup.js**
   - 处理用户交互事件
   - 向 background 发送消息请求
   - 接收并展示 Cookie 数据
   - 实现下载、复制、导入功能
   - 管理 Cookie 过滤和搜索

7. **_locales/**
   - 包含所有支持语言的翻译文件
   - 每种语言都有对应的 messages.json 文件
   - 支持中文、英文、法文三种语言

8. **README.md**
   - 用户安装和使用指南
   - 功能介绍和注意事项

9. **DEVELOPMENT.md**
   - 开发文档（即本文档）
   - 技术细节和维护说明

## 核心功能实现

### Cookie 导出功能

Cookie 导出是插件的核心功能，通过前后端协作实现。

#### 1. 当前网站 Cookie 导出

用户点击 "Export Current Site Cookies" 按钮时，执行以下流程：

1. popup.js 获取当前活动标签页 URL
2. 通过 `chrome.runtime.sendMessage` 向 background.js 发送导出请求
3. background.js 接收到请求后调用 `chrome.cookies.getAll({url: request.url})` 获取指定 URL 的 Cookie
4. 获取成功后将数据通过 `sendResponse` 返回给 popup
5. popup.js 接收数据并根据用户选择的格式进行转换
6. 显示结果并触发文件下载

#### 2. 所有 Cookie 导出

用户点击 "Export All Cookies" 按钮时，执行以下流程：

1. popup.js 向 background.js 发送导出所有 Cookie 的请求
2. background.js 调用 `chrome.cookies.getAll({})` 获取所有 Cookie
3. 按域名对 Cookie 进行分组处理（对于大量 Cookie 则跳过分组以提高性能）
4. 将处理后的数据返回给 popup
5. popup.js 接收数据并根据用户选择的格式进行转换
6. 显示结果并触发文件下载

### 数据格式

#### JSON 格式
``json
[
  {
    "name": "cookie_name",
    "value": "cookie_value",
    "domain": ".example.com",
    "path": "/",
    "expirationDate": 1234567890,
    "httpOnly": false,
    "secure": true,
    "session": false,
    "sameSite": "lax"
  }
]
```

#### CSV 格式
```
domain,flag,path,secure,expiration,name,value
".example.com",FALSE,"/",FALSE,1234567890,"cookie_name","cookie_value"
```

#### XML 格式
``xml
<?xml version="1.0" encoding="UTF-8"?>
<cookies>
  <cookie>
    <domain>.example.com</domain>
    <flag>FALSE</flag>
    <path>/</path>
    <secure>FALSE</secure>
    <expiration>1234567890</expiration>
    <name>cookie_name</name>
    <value>cookie_value</value>
  </cookie>
</cookies>
```

#### Netscape 格式
```
# Netscape HTTP Cookie File
# http://curl.haxx.se/rfc/cookie_spec.html
# This file was generated by Cookie Export Tool

.example.com	FALSE	/	FALSE	1234567890	cookie_name	cookie_value
```

### 文件下载功能

通过 Blob API 实现文件下载功能：

1. 创建包含指定格式数据的 Blob 对象
2. 使用 `URL.createObjectURL` 生成对象 URL
3. 创建隐藏的 `<a>` 元素并设置 download 属性
4. 触发点击事件完成下载
5. 清理创建的对象 URL

### 复制到剪贴板功能

使用 Clipboard API 实现一键复制功能：

1. 调用 `navigator.clipboard.writeText` 方法
2. 处理成功和失败回调
3. 提供用户反馈

### Cookie 导入功能

Cookie 导入功能允许用户从文件导入 Cookie：

1. 用户选择或拖放 Cookie 文件
2. 自动识别文件格式（根据扩展名）
3. 解析文件内容为 Cookie 对象
4. 验证 Cookie 数据格式
5. 将 Cookie 导入浏览器

### Cookie 管理功能

Cookie 管理功能提供完整的 Cookie 操作界面：

1. 显示所有 Cookie 列表
2. 支持按域名搜索
3. 支持按过期时间过滤（已过期/有效）
4. 支持查看详情
5. 支持删除单个或所有 Cookie

## 权限说明

Cookie Exporter 插件遵循最小权限原则，仅申请必要的权限：

### manifest.json 权限配置

```json
{
  "permissions": [
    "cookies",
    "activeTab"
  ],
  "host_permissions": [
    "<all_urls>"
  ]
}
```

### 权限详解

1. **cookies** 权限
   - 允许插件读取和操作浏览器中的 Cookie 信息
   - 这是实现 Cookie 导出和导入功能的核心权限
   - Chrome 将此权限标记为敏感权限，用户安装时会特别提示

2. **activeTab** 权限
   - 允许插件获取当前活动标签页的信息
   - 用于确定当前访问网站的 URL
   - 相对安全的权限，仅限当前标签页

3. **<all_urls>** host 权限
   - 允许插件访问所有网站的 Cookie
   - 是 `chrome.cookies.getAll` API 正常工作的必要条件
   - 用户在安装时会看到相关警告

### 安全注意事项

1. **数据安全**
   - 插件不会收集、存储或传输用户的 Cookie 数据
   - 所有处理均在本地浏览器环境中完成
   - 导出的文件仅保存在用户本地设备上

2. **隐私保护**
   - 不会连接任何外部服务器
   - 不会记录用户操作日志
   - Cookie 数据仅用于导出功能，不会用于其他目的

3. **使用建议**
   - 导出的 Cookie 文件包含敏感信息，请妥善保管
   - 不要在不安全的网络环境中使用此插件
   - 定期检查插件权限，确保符合个人隐私要求

4. **风险提示**
   - Cookie 信息可用于身份验证和会话管理
   - 请勿与他人共享导出的 Cookie 文件
   - 发现安全问题请及时停止使用

## 安装和使用指南

### 安装步骤

1. 在 Chrome 浏览器中打开 `chrome://extensions/`
2. 开启右上角的"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择包含此项目的文件夹
5. 插件安装成功后会在浏览器工具栏显示图标

### 使用方法

1. 访问任意网站
2. 点击浏览器工具栏中的 Cookie Exporter 图标
3. 在弹出窗口中选择功能标签页：

#### 导出标签页
- 设置导出选项（域名过滤、格式选择、安全选项等）
- 点击 "Export Current Site Cookies" 导出当前网站的 Cookie
- 点击 "Export All Cookies" 导出所有网站的 Cookie
- 使用 "Copy Current Site Cookies" 或 "Copy All Cookies" 复制到剪贴板

#### 导入标签页
- 点击 "浏览文件" 或拖放 Cookie 文件到指定区域
- 点击 "导入 Cookies" 按钮导入文件中的 Cookie

#### 管理标签页
- 查看所有 Cookie 列表
- 使用搜索框按域名或名称搜索 Cookie
- 使用过滤器显示已过期或有效的 Cookie
- 点击 "查看详情" 查看 Cookie 完整信息
- 点击 "删除" 删除单个 Cookie
- 使用 "删除所有 Cookie" 删除所有显示的 Cookie

### 界面说明

弹出窗口包含三个标签页：

1. **导出标签页**
   - 导出选项设置区域
   - 导出和复制按钮
   - 结果显示区域

2. **导入标签页**
   - 文件选择和拖放区域
   - 导入按钮
   - 进度显示

3. **管理标签页**
   - Cookie 列表显示区域
   - 搜索和过滤控件
   - 操作按钮

### 输出文件格式

- 当前网站 Cookie 文件名格式：`cookies-{domain}.{format}`
- 所有 Cookie 文件名格式：`all-cookies.{format}`
- 支持格式：json、csv、xml、txt（Netscape格式）

## 故障排除

### 常见问题及解决方案

#### 1. Service Worker 注册失败

**问题表现**：在加载扩展时出现 "Service worker registration failed" 错误

**可能原因及解决方案**：
- 检查 [background.js](file:///c:/Users/82490/Desktop/LingmaPythonProject/background.js) 文件中是否包含不兼容的 ES6 语法（如 `export` 语句）
- 确保 [background.js](file:///c:/Users/82490/Desktop/LingmaPythonProject/background.js) 文件编码为 UTF-8
- 检查 [manifest.json](file:///c:/Users/82490/Desktop/LingmaPythonProject/manifest.json) 中 background 配置是否正确

#### 2. SyntaxError: Invalid or unexpected token

**问题表现**：控制台报语法错误

**可能原因及解决方案**：
- 文件编码问题，确保所有文件都保存为 UTF-8 格式
- 特殊字符问题，重新创建问题文件
- 检查是否有不匹配的引号或括号

#### 3. Cookie 数据为空

**问题表现**：导出的 Cookie 数据为空或不完整

**可能原因及解决方案**：
- 检查插件权限是否正确配置
- 确认网站是否设置了 HttpOnly 标志的 Cookie（这些 Cookie 无法通过 JavaScript 访问）
- 检查浏览器设置是否阻止了 Cookie 访问

#### 4. 下载文件失败

**问题表现**：点击导出按钮后没有触发文件下载

**可能原因及解决方案**：
- 检查浏览器下载设置和权限
- 确认弹出窗口未被广告拦截器阻止
- 检查控制台是否有 JavaScript 错误

### 调试方法

1. 打开扩展管理页面 (`chrome://extensions/`)
2. 启用"开发者模式"
3. 点击插件卡片上的"检查视图"或"检查弹出窗口"
4. 在开发者工具中查看 Console 面板的错误信息
5. 在 Network 面板监控 API 请求

### 获取帮助

如遇到无法解决的问题，请提供以下信息寻求帮助：

1. Chrome 浏览器版本
2. 插件版本
3. 具体的错误信息
4. 重现步骤
5. 控制台输出的错误日志

# 开发说明

## 项目结构

```
.
├── _locales/                 # 国际化资源文件
│   ├── zh_CN/               # 中文语言包
│   ├── en/                  # 英文语言包
│   └── fr/                  # 法文语言包
├── icons/                   # 扩展图标
├── js/                      # JavaScript 模块
│   ├── modules/            # 核心功能模块
│   │   ├── cookieFormatter.js  # Cookie 格式化模块
│   │   ├── cookieValidator.js  # Cookie 验证模块
│   │   ├── errorLogger.js      # 错误日志模块
│   │   └── index.js            # 模块入口文件
│   ├── ui/                 # UI 管理模块
│   │   └── uiManager.js    # UI 管理模块
│   └── utils/              # 工具函数
│       └── utils.js        # 通用工具函数
├── background.js            # 后台脚本
├── popup.html               # 弹窗页面
├── popup.js                 # 弹窗脚本
├── manifest.json            # 扩展配置文件
├── README.md                # 使用说明
└── DEVELOPMENT.md           # 开发说明
```

## 技术栈

- JavaScript (ES6+)
- Chrome Extension API
- HTML5/CSS3

## 模块说明

### 核心模块

1. **cookieFormatter.js** - Cookie 格式化模块
   - 支持多种格式转换 (JSON, CSV, XML, Netscape)
   - 提供导入数据解析功能

2. **cookieValidator.js** - Cookie 验证模块
   - 验证导入的 Cookie 数据格式
   - 确保数据完整性

3. **errorLogger.js** - 错误日志模块
   - 记录运行时错误
   - 提供错误导出功能

4. **uiManager.js** - UI 管理模块
   - 统一的 UI 操作接口
   - 进度条、加载状态等

5. **utils.js** - 工具函数模块
   - 字符串转义、URL 解析等通用功能

### 主要文件

1. **background.js** - 后台脚本
   - 处理 Cookie 操作
   - 响应 popup 发送的消息

2. **popup.js** - 弹窗脚本
   - 处理用户交互
   - 界面逻辑控制

3. **popup.html** - 弹窗页面
   - 提供用户界面
   - 包含三个标签页：导出、导入、管理

## 开发环境

- Chrome 浏览器 88+
- 文本编辑器或 IDE

## 安装和调试

1. 在 Chrome 中打开 `chrome://extensions/`
2. 启用"开发者模式"
3. 点击"加载已解压的扩展程序"
4. 选择项目目录

## 国际化支持

- 使用 Chrome i18n API
- 支持中文、英文、法文
- 可通过 `_locales` 目录添加新语言

## 代码规范

- 使用 ES6 模块系统
- 函数和变量采用驼峰命名法
- 添加适当的注释和 JSDoc 文档
- 遵循 Chrome 扩展开发最佳实践

## 构建和发布

1. 确保所有功能测试通过
2. 更新版本号
3. 打包扩展程序
4. 提交到 Chrome Web Store
